# Reflection — Traveling Merchant: New Game во время магазина (hotfix v1)

## Summary
Исправили баг: пока активен режим **Странствующего торговца** (`merchant.isActive`), кнопка **New Game / Новая игра** не работала. Причина — доменный “гейт” в `gameReducer`, который во время торговца **отбрасывал почти все экшены**, включая `START_GAME`. Решение: разрешить системные действия `START_GAME` (и `INIT_GAME`) даже при активном торговце.

## What Went Well
- Быстро локализовали: проблема была **не в UI**, а в доменной защите (ранний `return state`).
- Фикс минимальный и точечный: расширили allowlist, не ослабляя блокировки боевых действий.

## Challenges Encountered
- “Новая игра” выглядит как UI‑кнопка, но реально ломалась в домене — легко потратить время на поиск по `pointer-events`/оверлеям, если не помнить про доменные гейты.

## Lessons Learned
- Если вводим “режим” (merchant overlay), который блокирует действия, нужно явно выделять:
  - **игровые действия** (их блокируем),
  - **системные команды** (`START_GAME`, `INIT_GAME`, выход/навигация) — они должны работать всегда.

## Process Improvements
- В чеклист smoke‑тестов для новых режимов добавить пункт: “**New Game работает в любом состоянии** (в т.ч. в режиме магазина/паузы/модалок)”.

## Technical Improvements
- В `gameReducer.ts` комментариями закрепили инвариант: “системные команды не блокируем merchant‑режимом”.

## Next Steps
- (Опционально) Аналогично проверить/зафиксировать, что “Выход в меню” (если оформлен отдельным action) тоже не может быть заблокирован доменным гейтом.


