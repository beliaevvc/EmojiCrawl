# Reflection: Версионирование 0.1.N и сохранение истории версий (generate-version.js)

## Enhancement Summary
Обновили скрипт `scripts/generate-version.js`, чтобы версия в `src/data/version_history.json` формировалась как **`0.1.N`**, где **`N` считается заново с 0** (после точки старта новой серии). Дополнительно исправили проблему, из-за которой при каждом запуске скрипт **затирал** историю коммитов: теперь история **мержится** (с дедупликацией), поэтому старые записи (в т.ч. “прошлая серия” 0.0.*) сохраняются.

## What Went Well
- Скрипт остался **простым и автономным**: всё так же работает до `vite`/`build` через `package.json`.
- Добавили **явный “якорь”** для счётчика серии 0.1 (`baseRef`) и сделали его переопределяемым через env — удобно для CI/перезапуска серии без правок кода.
- Быстро поймали и закрыли UX-проблему: история коммитов в `version_history.json` теперь **не исчезает**.

## Challenges Encountered
- Изначально логика “N с нуля” конфликтовала с ожиданием “старые коммиты должны остаться”: одно относится к номеру версии, другое — к сохранению истории.
- Риск “тихой потери данных”: при ошибках Git fallback мог бы **перезаписать** файл и стереть историю.

## Solutions Applied
- Для версии `0.1.N` ввели базовую точку отсчёта `baseRef` и считаем `N` через `git rev-list --count <baseRef>..HEAD`.
- Для истории коммитов:
  - читаем существующий `src/data/version_history.json` (если есть),
  - собираем новые коммиты из `git log`,
  - **мержим** (новые сверху) и **дедуплицируем по `hash`**.
- Для fallback при ошибках: **не затираем** существующий `version_history.json`; fallback пишем только если файла ещё нет.

## Key Technical Insights
- “Номер версии” и “история коммитов” — разные сущности: версию можно обнулить, но историю нельзя терять.
- Для “обнуления серии” безопаснее считать коммиты через диапазон `<baseRef>..HEAD`, чем “общее число коммитов репо”.
- При генерации артефактов сборки важно избегать сценариев, где обработка ошибок затирает ранее валидные данные.

## Process Insights
- Хорошо работает подход “сначала сделать минимально, потом уточнить требования”: мы быстро получили `0.1.N`, а затем довели до ожидаемого поведения (сохранение истории).
- Для таких задач стоит сразу проговаривать: “обнуляем только `version`, или ещё и `commits`?” — это экономит 1 итерацию.

## Action Items for Future Work
- Зафиксировать “точку старта” 0.1.x более формально:
  - либо выставить `DEFAULT_VERSION_BASE_REF` на нужный коммит,
  - либо завести git-тег (например, `v0.1.0-base`) и ссылаться на него (вместо хеша).
- (Опционально) Добавить в UI отображение `baseRef`/“серии”, чтобы было понятно, откуда считается `N`.
- (Опционально) Определиться с политикой размера файла: сейчас по умолчанию берём `200` коммитов из git log и мержим со старым списком — можно добавить “max commits” и обрезку хвоста, если файл начнёт разрастаться.

## Time Estimation Accuracy
- Estimated time: ~20 минут
- Actual time: ~35–45 минут
- Variance: ~+75–125%
- Reason for variance: уточнение требований на ходу (версия “с нуля” vs “история не должна пропасть”) и добавление надёжного merge/fallback-поведения.


