# Блок 90 — Ревизия и пересборка документации Memory Bank (после рефакторинга)

## Цель
После завершения основных архитектурных блоков (0–6 и далее) сделать “генеральную уборку” документации:
- привести `memory-bank/` к новой архитектуре и реальным границам слоёв,
- убрать устаревшие описания/дубли,
- сделать документацию **полезной как навигация по проекту** (что где лежит и почему),
- чтобы следующий новый чат/перезапуск Cursor мог быстро восстановить контекст.

## Почему это отдельный блок
Пока код активно переезжает по слоям/папкам, документация неизбежно будет “дрожать”.  
Отдельный блок гарантирует, что после стабилизации архитектуры мы **закроем петлю** и сделаем Memory Bank “истиной”.

## Scope
### Делаем
- Обновляем/переписываем ключевые документы:
  - `memory-bank/projectbrief.md` (если нужно — уточнить V2 цели)
  - `memory-bank/productContext.md`
  - `memory-bank/techContext.md` (актуальная структура, зависимости, сборка)
  - `memory-bank/systemPatterns.md` (правила слоёв, плагины, ports/adapters, чекпойнты)
  - `memory-bank/uiDesign.md` (новые UI-паттерны после декомпозиции)
  - `memory-bank/infoHUD.md` (если HUD был переработан)
  - `memory-bank/gameMechanics.md` (если менялись правила/потоки)
  - `memory-bank/gameContent.md` (если вводили `GameContent`/packs)
- Вводим “индекс” документации:
  - краткая карта: **где что искать** (код ↔ доки ↔ ответственность)
- Проверяем соответствие: “правило документации” ↔ “реальные точки в коде”.

### Не делаем
- Не меняем поведение игры (это чисто документирование).
- Не добавляем новый контент/механику.

## План работ (маленькими порциями)
1) **Собрать список фактических подсистем** после рефакторинга:
   - game domain/application/ui
   - content packs
   - infrastructure (supabase/localStorage)
   - plugins (devquest/overlays)
2) **Обновить опорные документы** (systemPatterns/techContext) — они задают “скелет”.
3) **Обновить фичевые документы** (gameMechanics/gameContent/uiDesign/infoHUD) по мере изменений.
4) **Сделать индекс (README Memory Bank)**:
   - “какой документ за что отвечает”
   - “где в коде живёт система”
5) **Финальный чекпойнт**:
   - `activeContext.md`: текущий фокус и ссылки на актуальные планы
   - `progress.md`: что завершено, что дальше

## Критерии готовности (DoD)
- Документация не противоречит коду и отражает новые границы слоёв.
- Есть индекс/карта, позволяющая новому контрибьютору за 10 минут понять архитектуру.
- Дубли минимальны: один источник истины для списков (контент в `gameContent`, правила в `gameMechanics`, UI-паттерны в `uiDesign`).

---

## Целевая структура Memory Bank (что за что отвечает)

### Принцип
Каждый документ должен отвечать на 3 вопроса:
1) **“Зачем это существует?”** (для кого и в каком сценарии чтения)
2) **“Где это в коде?”** (ссылки на реальные папки/файлы)
3) **“Что является источником правды?”** (чтобы не было дублирования)

### Индекс (новый файл)
- `memory-bank/README.md` — **единая точка входа**:
  - “что читать сначала”
  - карта документов
  - матрица “код ↔ документ”
  - правила обновления (когда и что трогать)

### Контекст/процесс (живые файлы)
- `memory-bank/activeContext.md` — **текущий фокус + ссылки** (коротко, без энциклопедии).
- `memory-bank/progress.md` — **хронология** (что сделано и когда).
- `memory-bank/tasks.md` — **крупные задачи** (если используется как backlog/спека).
- `memory-bank/refactor/*` — **история/планы рефакторинга** (уже есть, не пересобираем, только проверяем актуальные ссылки).

### “Опорные” документы (скелет понимания проекта)
- `memory-bank/projectbrief.md` — **что это за проект и зачем он существует** (1–2 страницы).
- `memory-bank/productContext.md` — **для кого продукт, какие UX-цели** (без технических деталей).
- `memory-bank/techContext.md` — **как это собрать/запустить + реальная структура проекта** (папки, алиасы, скрипты, деплой).
- `memory-bank/systemPatterns.md` — **архитектурные правила** (слои, ports/adapters, плагины, “где живёт I/O”, договорённости по комментариям/докам).

### Документы про “игру”
- `memory-bank/gameMechanics.md` — **правила и инварианты** (что считается действием, условия раундов, блокировки и т.д.).
  - Не хранит каталоги контента целиком — только правила и ссылки.
- `memory-bank/gameContent.md` — **каталог контента** (spells/curses/abilities и т.п.) + “источник правды” (файлы `src/content/*`).
- `memory-bank/uiDesign.md` — **дизайн-система и UX-паттерны** (слои, HUD, модалки, токены, анимации).
- `memory-bank/gameTokensDesign.md` — **детальные стандарты токенов/слотов** (если не сливаем в `uiDesign.md`; цель — низкоуровневые спецификации).
- `memory-bank/infoHUD.md` — **спека Info-режима** (что входит, как настраивается, где живёт состояние/персистентность).

### Документы про подсистемы
- `memory-bank/wallet.md` — кошелёк.
- `memory-bank/devQuest.md` — devquest/плагины/аномалии (мета-слой).

---

## Единый формат документа (шаблон)

### Обязательные секции (для всех `memory-bank/*.md`, кроме progress)
1) **Назначение**: 2–6 строк, что это за документ и в каких случаях его читать.
2) **Источник правды (Source of Truth)**:
   - список файлов/директорий в коде, которые считаются истинными
   - если документ справочный — так и написать
3) **Где в коде (Entry points / Links)**:
   - 3–10 ссылок на ключевые файлы/папки (по факту, не “как было раньше”)
4) **Содержание**: основной текст документа (правила/каталог/паттерны).
5) **Правила обновления**:
   - триггеры “когда обновлять” (например: “изменили доменный редьюсер → обновить ...”)
6) **Связанные документы**: ссылки на 3–8 соседних docs, чтобы не плодить дубли.
7) **Последнее обновление**: дата (YYYY-MM-DD) + короткая причина (1 строка).

### Стиль и конвенции
- Язык документации: **русский**.
- Пути к файлам: в обратных кавычках, например `src/features/game/domain/reducer/gameReducer.ts`.
- Списки “каталогов” (spells/abilities/curses) храним **в одном месте** (`gameContent.md`), остальные документы на них **ссылаются**.
- Нельзя держать устаревшие пути “для примера”: если файл переехал — ссылка должна быть обновлена.



