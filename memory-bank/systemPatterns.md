# Архитектура и Паттерны (System Patterns)

## Принципы Разработки
*   **Чистый код (Clean Code):** Приоритет отдается читаемости и поддерживаемости, а не скорости написания "грязных" хаков.
*   **SOLID:** Стремление к слабой связности компонентов. Логика игры должна быть отделена от UI.
*   **Комментарии:** Обязательное комментирование сложной логики и архитектурных решений **на русском языке**.

## Правила Документирования (Documentation Rules)
*   **Синхронизация Механик:** При любых изменениях в игровой логике (`src/utils/gameReducer.ts`, `src/utils/gameLogic.ts`) необходимо обновлять `memory-bank/gameMechanics.md`.
*   **Синхронизация Контента:** При добавлении новых карт, монстров или способностей необходимо обновлять `memory-bank/gameContent.md`.
*   **Синхронизация Дизайна:** При создании новых UI компонентов или изменении стилей необходимо сверяться с `memory-bank/uiDesign.md` и обновлять его при внесении изменений в дизайн-систему.
*   **Синхронизация InfoHUD:** При изменении функционала, внешнего вида или добавлении новых элементов в информационный оверлей (меню Info) необходимо обновлять `memory-bank/infoHUD.md`.
*   **Single Source of Truth:** Документация должна ссылаться друг на друга, избегая дублирования списков (например, список способностей живет в `gameContent.md`, а правила их триггеров — в `gameMechanics.md`).

## Архитектура Приложения (React + Vite)

### 1. State Management (Zustand)
Используется глобальное управление состоянием.
*   `useGameStore`: Состояние активной игровой сессии (здоровье, текущая рука, сброс, поле боя).
*   `useEditorStore`: Состояние редакторов (создание колод, настройка врагов).
*   `useDevQuestStore`: (Мета-слой) Состояние консоли и пасхалок.
*   `useAuthStore`: Сессия Supabase.

### 2. Масштабируемость (V2 Challenges)
Текущая проблема — монолитность игровой логики. Для V2 требуется внедрение паттернов для поддержки:
*   **Разных "Комнат" (Rooms):** Логика смены окружения и наборов врагов.
*   **Фабрики Сущностей:** Унифицированный способ создания карт и врагов, вместо хардкода.
*   **Менеджер Эффектов:** Централизованная обработка взаимодействий (Weapon -> Monster, Potion -> Player).

### 3. Drag-and-Drop
Используется `react-dnd`.
*   Необходимо строгое разделение логики *визуального перетаскивания* и *бизнес-логики применения карты*.
*   Адаптер для Touch-устройств обязателен.

### 4. Файловая Структура
*   `src/data/`: Статические данные (конфиги, баланс). В будущем здесь может появиться слой адаптеров для Supabase.
*   `src/components/game/`: Игровые компоненты (Карта, Слот, Поле).
*   `src/components/editor/`: Инструменты для Геймдизайнера.
*   `src/lib/`: Чистые функции и бизнес-логика, не зависящая от React компонентов.

## Соглашения по коду
*   Именование переменных и функций на английском.
*   JSDoc и поясняющие комментарии внутри блоков логики — **на русском**.
*   Избегать "Magic Numbers" в коде механик — все выносить в константы или конфиги.
